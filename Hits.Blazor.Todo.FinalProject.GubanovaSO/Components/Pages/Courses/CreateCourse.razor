@page "/courses/create"
@page "/courses/edit/{Id:int}"
@using Hits.Blazor.Todo.FinalProject.GubanovaSO.Models
@using Hits.Blazor.Todo.FinalProject.GubanovaSO.Data.Services
@using Microsoft.AspNetCore.Authorization
@using Microsoft.AspNetCore.Components.Authorization
@attribute [Authorize]
@inject CourseService courseService
@inject AuthenticationStateProvider AuthenticationStateProvider

<div class="container py-4">
    <h3>@(Id == 0 ? "Новый курс" : "Редактировать курс")</h3>

    <form method="post" action="/courses/save">
        <input type="hidden" name="id" value="@courseData.Id" />

        <div class="form-group mb-3">
            <label class="form-label">Название *</label>
            <input type="text" name="title" value="@courseData.Title" class="form-control" required />
        </div>

        <div class="form-group mb-3">
            <label class="form-label">Описание</label>
            <textarea name="description" class="form-control" rows="3">@courseData.Description</textarea>
        </div>

        <div class="form-group mb-3">
            <label class="form-label">Содержание</label>
            <textarea name="content" class="form-control" rows="8">@courseData.Content</textarea>
        </div>

        <div class="form-group mb-3">
            <label class="form-label">Категория</label>
            <input type="text" name="category" value="@courseData.Category" class="form-control" />
        </div>

        <div class="form-group mb-3">
            <label class="form-label">Часов (1–1000)</label>
            <input type="number" name="durationHours" value="@courseData.DurationHours" class="form-control" min="1" max="1000" required />
        </div>

        <div class="form-group mb-3">
            <label class="form-label">Уровень (1–3)</label>
            <input type="number" name="difficultyLevel" value="@courseData.DifficultyLevel" class="form-control" min="1" max="3" required />
        </div>

        <div class="d-flex gap-2">
            <button type="submit" class="btn btn-primary">Сохранить</button>
            <a href="/courses" class="btn btn-secondary">Отмена</a>
        </div>
    </form>
</div>

@code {
    [Parameter]
    public int Id { get; set; }

    private Course courseData = new();

    protected override async Task OnInitializedAsync()
    {
        courseData = new Course
        {
            DurationHours = 1,
            DifficultyLevel = 1,
            Title = "",
            Description = "",
            Category = ""
        };

        if (Id != 0)
        {
            var course = await courseService.GetCourseByIdAsync(Id);
            if (course != null)
            {
                courseData = course;
            }
        }
    }
}
